directive @isAuthenticated on FIELD | FIELD_DEFINITION
# directive @hasRole(role: Role!) on FIELD_DEFINITIONenum Role { ADMIN USER }
directive @hasPermission(permission: String) on FIELD | FIELD_DEFINITION

scalar JSON
scalar Date

union Result = User | Site

input SitesInfoInput {
	siteId: ID!
	permissions: [PermissionInfoInput!]!
}

input CreateUserInput {
	firstName: String!
	lastName: String!
	email: String!
	password: String!
	sites: [SitesInfoInput!]!
}

input UpdateUserInput {
	firstName: String!
	lastName: String!
	password: String!
	sites: [SitesInfoInput!]!
}

input LoginUserInput {
	email: String!
	password: String!
}

type LoginResponse {
	token: String!
	userPermissions: [UserPermissionsInfo!]!
}

type UserPermissionsInfo {
	siteId: ID!
	siteName: String
	permissions: [PermissionInfo!]!
	sitepermissions: [String!]!
}

type PermissionInfo {
	_id: ID
	code: String
}

type User {
	_id: ID!
	firstName: String!
	lastName: String!
	email: String!
	password: String!
	resetPasswordToken: String
	resetPasswordExpires: Float
	fullName: String
	isLocked: Boolean!
	reason: String!
	isActive: Boolean!
	createdAt: Float!
	updatedAt: Float!
}

type Query {
	hello: String!
	me: User @isAuthenticated
	users(offset: Int, limit: Int): [User!] @isAuthenticated
	user(_id: ID!): User @isAuthenticated
	search(text: String!, type: String!): [Result]!
}

type Mutation {
	createUser(input: CreateUserInput!): User
		@hasPermission(permission: "USER_CREATE")
	updateUser(_id: ID!, input: UpdateUserInput!): Boolean
		@hasPermission(permission: "USER_UPDATE")
	deleteUser(_id: ID!): Boolean @hasPermission(permission: "USER_DELETE")
	deleteUsers: Boolean! @isAuthenticated
	login(input: LoginUserInput!): LoginResponse
	lockAndUnlockUser(_id: ID!, reason: String!): Boolean
		@hasPermission(permission: "USER_LOCK_AND_UNLOCK")
	forgotPassword(email: String!): Boolean
	resetPassword(resetPasswordToken: String!, password: String!): Boolean
}

type Subscription {
	userCreated: User @isAuthenticated
}
